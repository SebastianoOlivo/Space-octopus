function collisions(t,i,e){var o,s,r,n,a;return o=!1,t.centerX=e.toGlobal(t.position).x+t.width/2,t.centerY=e.toGlobal(t.position).y+t.height/2,i.centerX=i.x+i.width/2,i.centerY=i.y+i.height/2,t.halfWidth=t.width/2,t.halfHeight=t.height/2,i.halfWidth=i.width/2,i.halfHeight=i.height/2,n=t.centerX-i.centerX,a=t.centerY-i.centerY,s=t.halfWidth+i.halfWidth,r=t.halfHeight+i.halfHeight,o=Math.abs(n)<s&&Math.abs(a)<.5*r?!0:!1}function Keyboard(t){function i(){function t(){stage.children[7].position.x-=7,n&&requestAnimationFrame(t)}n=!0,stage.children[7].skew.x=-.2,stage.children[7].scale.y=.55,t()}function e(){function t(){stage.children[7].position.x+=7,n&&requestAnimationFrame(t)}n=!0,stage.children[7].skew.x=.2,stage.children[7].scale.y=.55,t()}function o(){function t(){stage.children[7].position.y-=7,n&&requestAnimationFrame(t)}n=!0,stage.children[7].scale.y=.7,t()}function s(){function t(){stage.children[7].position.y+=7,n&&requestAnimationFrame(t)}n=!0,stage.children[7].scale.y=.5,t()}var r={};r.code=t,r.isDown=!1,r.isUp=!0,r.press=void 0,r.release=void 0;var n=!1;return r.downHandler=function(t){37===t.keyCode&&i(),39===t.keyCode&&e(),38===t.keyCode&&o(),40===t.keyCode&&s(),t.preventDefault()},r.upHandler=function(t){n=!1,stage.children[7].skew.x=0,stage.children[7].scale.y=.6,t.preventDefault()},activeListeners||(window.addEventListener("keydown",r.downHandler.bind(r),!1),window.addEventListener("keyup",r.upHandler.bind(r),!1),activeListeners=!0),r}function Light(t){this.light,this.addLight(),this.posX=200,this.posY=200}function Map(){}function MapBuilder(t){PIXI.ParticleContainer.call(this),this.number=t,this.createRocks(),this.createSushis(),this.side="left",this.viewportY=0}function MapGenerator(t){this.maps=[],this.stage=t,this.MAP_NUMBERS=5,this.displayedMaps=2}function Panel(){this.addPanel()}function Player(t,i){this.sound,this._path=t,this._loop=i}function Scoring(){var t={font:"bold italic 36px Arial",align:"right",fill:"#F7EDCA",stroke:"#4a1850",strokeThickness:5,dropShadow:!0,dropShadowColor:"#000000",dropShadowAngle:Math.PI/6,dropShadowDistance:6,wordWrap:!0,wordWrapWidth:440},i={font:"bold italic 28px Arial",fill:"#7ED321",stroke:"#4a1850",strokeThickness:5,dropShadow:!0,dropShadowColor:"#000000",dropShadowAngle:Math.PI/6,dropShadowDistance:6,wordWrap:!0,wordWrapWidth:440};this.scoreText=new PIXI.Text("0 m",t),this.scoreText.x=15,this.scoreText.y=GAMEHEIGHT-100,stage.addChild(this.scoreText),this.bestScoreText=new PIXI.Text("0 m",i),this.bestScoreText.x=15,this.bestScoreText.y=GAMEHEIGHT-55,stage.addChild(this.bestScoreText)}function Squid(){this.squids=[],this.squidsNumber=2,this.addSquid()}function Background(t,i,e,o){this.delta=t;var s=e,r=o;PIXI.extras.TilingSprite.call(this,SPRITEID[i],s,r),this.position.x=0,this.position.y=0,this.tilePosition.x=0,this.tilePosition.y=0,this.viewportY=0}function soudLoaded(){ambiance=new Player("audio/ambiance.mp3",!0),impact=new Player("audio/impact.mp3"),last_breath=new Player("audio/last_breath.wma"),monster_attack=new Player("audio/monster_attack.mp3"),splash=new Player("audio/splash.wma"),ambiance.loadSound(),ambiance.playSound()}function showPanel(){SPRITEID=PIXI.loader.resources["sprites/spriteSheet.json"].textures,panel=new Panel,window.addEventListener("keydown",game,!1)}function game(){function t(i){requestAnimationFrame(t),TWEEN.update(i)}function i(){s.moveViewportYBy(scrollSpeed),r.moveViewportYBy(scrollSpeed),n.outOfScreen(),scoring.setScore(currentScore),scoring.setBestScore(bestScore),stage.children.forEach(function(t,i,e){if(MapBuilder.prototype.isPrototypeOf(t)){var o=t;t.children.forEach(function(t,i,e){return collisions(t,stage.children[7],o)?void("rock"==t.name?endGame(currentScore):1==t.validity&&(currentScore+=10,t.position.x=-GAMEWIDTH,scrollSpeed*=.7,t.validity=!1)):void 0})}}),renderer.render(stage),requestAnimationFrameId=requestAnimationFrame(i)}var e=new PIXI.filters.PixelateFilter;stage.filters=[e];var o={x:0,y:16};new TWEEN.Tween(o).to({x:0,y:1},500).onUpdate(function(){e.size.y=this.y,e.size.x=this.y}).start();requestAnimationFrame(t),panel.removePanel(),window.removeEventListener("keydown",game,!1);var s=new Scroller(stage),r=new MapGenerator(stage);r.generateMap(),currentScore=0;var n=new Squid;Keyboard(),scoring=new Scoring,setIntervalId=setInterval(function(){currentScore+=.08,scrollSpeed+=.002},9),i()}function endGame(t){t>bestScore&&(bestScore=t),t=0,stage=new PIXI.Container,cancelAnimationFrame(requestAnimationFrameId),clearInterval(setIntervalId),scrollSpeed=5,setTimeout(showPanel,100)}function Scroller(t){this.far=new Background(.2,"far.png",GAMEWIDTH,600),t.addChildAt(this.far,0),this.mid=new Background(.4,"mid.png",GAMEWIDTH,600),t.addChildAt(this.mid,1),this.viewportY=0}Light.constructor=Light,Light.prototype=Object.create(PIXI.Graphics.prototype),Light.prototype.addLight=function(){this.light=new MovingItem("light.png"),this.light.x=posX,this.light.y=posX,stage.addChild(this.light)},Light.prototype.moveLight=function(t,i){this.light.x=t,this.light.y=t},MapBuilder.constructor=MapBuilder,MapBuilder.prototype=Object.create(PIXI.ParticleContainer.prototype),MapBuilder.prototype.createBorders=function(){this.borders=[],this.addBorderSprites(3,"border01.png"),this.addBorderSprites(2,"border02.png"),this.addBorderSprites(2,"border03.png"),this.addBorderSprites(2,"border04.png"),this.addBorderSprites(2,"jellyfish.png"),this.shuffle(this.borders)},MapBuilder.prototype.addBorderSprites=function(t,i){for(var e=0;t>e;e++){var o=PIXI.Sprite.fromFrame(i);this.borderSide(o,this.side),e%2==0&&(o.scale.x=-1),this.addChild(o)}},MapBuilder.prototype.createRocks=function(){this.addRocksprites(1,"rock01.png"),this.addRocksprites(1,"rock02.png"),this.addRocksprites(1,"rock03.png"),this.addRocksprites(1,"rock04.png"),this.addRocksprites(1,"rock05.png"),this.addRocksprites(1,"rock06.png"),this.addRocksprites(1,"rock07.png")},MapBuilder.prototype.addRocksprites=function(t,i){var e=0;for(e;t>e;e++){var o=PIXI.Sprite.fromFrame(i),s=Math.random()*(.7-1)+.7;o.scale.x=s,o.scale.y=s;this.randomPos(o,GAMEWIDTH+20,-20,MAP_HEIGHT);o.name="rock",this.addChild(o)}},MapBuilder.prototype.createSushis=function(){this.addSushisprites(1,"sushi01.png"),this.addSushisprites(1,"sushi02.png")},MapBuilder.prototype.addSushisprites=function(t,i){for(var e=0;t>e;e++){var o=PIXI.Sprite.fromFrame(i),s=.8;o.scale.x=s,o.scale.y=s,o.name="sushi",o.validity=!0,this.randomPos(o,GAMEWIDTH,MAP_HEIGHT/(t/e),MAP_HEIGHT/(t/e)+MAP_HEIGHT/t),this.addChild(o)}},MapBuilder.prototype.borderSide=function(t,i){t.position.y=this.randomInt(0,MAP_HEIGHT-t.height),"left"===i?(t.position.x=0,this.side="right"):(t.position.x=400,this.side="left")},MapBuilder.prototype.randomPos=function(t,i,e,o){t.position.x=this.randomInt(0,i-t.width),t.position.y=this.randomInt(e,o-t.height)},MapBuilder.prototype.randomInt=function(t,i){return Math.floor(Math.random()*(i-t+1))+t},MapBuilder.prototype.shuffle=function(t){for(var i=t.length,e=3*i,o=0;e>o;o++){var s=t.pop(),r=Math.floor(Math.random()*(i-1));t.splice(r,0,s)}},MapBuilder.prototype.setViewportY=function(t){var i=t-this.viewportY;this.viewportY=t,this.position.y+=.8*i},MapGenerator.prototype.generateMap=function(){var t=this.MAP_NUMBERS;this.displayedMaps-1;for(t;t>0;t--){var i=new MapBuilder(t);this.maps.push(i)}this.maps.forEach(function(t,i,e){MapGenerator.prototype.addMapToStage(e[i],GAMEHEIGHT)}),this.maps[0].position.y=-MAP_HEIGHT},MapGenerator.prototype.addMapToStage=function(t,i){t.position.y=i,stage.addChild(t)},MapGenerator.prototype.setViewportY=function(t){this.displayedMaps-1;this.digestMapCycle(),this.maps[0].setViewportY(this.maps[0].viewportY+t),this.maps[1].setViewportY(this.maps[1].viewportY+t)},MapGenerator.prototype.digestMapCycle=function(){if(this.maps[0].position.y+GAMEHEIGHT===0&&(this.maps[1].position.y=-MAP_HEIGHT,console.log("add")),this.maps[0].position.y-GAMEHEIGHT>=0){this.maps[0].position.y=-MAP_HEIGHT;var t=this.maps.shift();this.maps.push(t)}},MapGenerator.prototype.getViewportY=function(){return this.maps[0].viewportY},MapGenerator.prototype.moveViewportYBy=function(t){this.setViewportY(t)},MovingItem=function(t,i,e){PIXI.Sprite.call(this,SPRITEID[t]),this.position.x=80,this.position.y=300},MovingItem.constructor=MovingItem,MovingItem.prototype=Object.create(PIXI.Sprite.prototype),Panel.prototype.addPanel=function(){function t(i){requestAnimationFrame(t),TWEEN.update(i)}var i=new MovingItem("start.png");i.position.x=0,i.position.y=0,i.alpha=.2;i.alpha;stage.addChild(i);var e={x:0,y:0};new TWEEN.Tween(e).to({x:0,y:1},1e3).onUpdate(function(){i.alpha=this.y,renderer.render(stage)}).start();requestAnimationFrame(t),this.removePanel=function(){stage.removeChild(i)}},Player.prototype.loadSound=function(){this.sound=sounds[this._path]},Player.prototype.playSound=function(){this._loop===!0&&(this.sound.loop=!0),this.sound.play()},Player.prototype.pauseSound=function(){this.sound.pause()},Scoring.prototype.setScore=function(t){this.scoreText.text=Math.round(t)+" m"},Scoring.prototype.setBestScore=function(t){this.bestScoreText.text=Math.round(t)+" m"},Squid.prototype.addSquid=function(){this.squid=new MovingItem("octopus.png"),this.squid.scale.x=.6,this.squid.scale.y=.6,this.squid.position.x=GAMEWIDTH/2-this.squid.width/2,this.squid.position.y=GAMEHEIGHT/2-this.squid.height/2,stage.addChild(this.squid),this.light=new MovingItem("light.png"),this.light.position.x=this.squid.x-this.light.width/2,this.light.position.y=this.squid.y-this.light.height/2,this.light.scale.x=2,this.light.scale.y=2,stage.addChild(this.light)},Squid.prototype.outOfScreen=function(){this.squid.position.x+this.squid.width/2>GAMEWIDTH&&(this.squid.position.x=-this.squid.width/2),this.squid.position.x<-(this.squid.width/2)&&(this.squid.position.x=GAMEWIDTH-this.squid.width/2),this.squid.position.y>GAMEHEIGHT-40&&(this.squid.position.y=GAMEHEIGHT-40),this.squid.position.y<0&&(this.squid.position.y=0),this.light.position.x=this.squid.x+this.squid.width/2-this.light.width/2,this.light.position.y=this.squid.y+this.squid.height/2-this.light.height/2},Background.constructor=Background,Background.prototype=Object.create(PIXI.extras.TilingSprite.prototype),Background.prototype.setViewportY=function(t){var i=t-this.viewportY;this.viewportY=t,this.tilePosition.y+=i*this.delta};var canvas=document.querySelector("#game"),GAMEWIDTH=canvas.width,GAMEHEIGHT=canvas.height,MAP_HEIGHT=1800,SPRITEID,scrollSpeed=6,activeListeners=!1,animation,requestAnimationFrameId,setIntervalId,currentScore=0,bestScore=0,panel,requestId,renderer=PIXI.autoDetectRenderer(GAMEWIDTH,GAMEHEIGHT,{view:canvas}),stage=new PIXI.Container;PIXI.loader.add("sprites/spriteSheet.json").load(showPanel),sounds.load(["audio/ambiance.mp3","audio/impact.mp3","audio/last_breath.mp3","audio/monster_attack.mp3","audio/splash.mp3"]),sounds.whenLoaded=soudLoaded;var ambiance="",impact="",last_breath="",monster_attack="",splash="";Scroller.prototype.setViewportY=function(t){this.viewportY=t,this.far.setViewportY(t),this.mid.setViewportY(t)},Scroller.prototype.getViewportY=function(){return this.viewportY},Scroller.prototype.moveViewportYBy=function(t){var i=this.viewportY+t;this.setViewportY(i)};